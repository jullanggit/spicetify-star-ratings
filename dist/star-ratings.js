!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var d,i,r,p,B,f,u,m,y,g,h,b,n,l,c,v,a,D,w,O,o,e,t,s,S,x,k,E,N,C,j,q;d=Spicetify.React,i=Spicetify.React,r=Spicetify.React,p=[null,null,null,null,"[index] 16px [first] 4fr [var1] 2fr [var2] 1fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] 2fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] minmax(120px,2fr) [var3] 2fr [last] minmax(120px,1fr)"],B=()=>Spicetify.Player.data.item.uri,m={},y={},g={},v=[],C=N=E=k=x=!(a=[]),j=S=s=t=e=o=O=w=D=c=l=n=b=h=u=f=null,q=async function(){for(;!Spicetify?.showNotification;)await new Promise(e=>setTimeout(e,100));ee(f=function(){var e={halfStarRatings:!0,likeThreshold:"4.0",enableKeyboardShortcuts:!0,showPlaylistStars:!0,nowPlayingStarsPosition:"left",skipThreshold:"disabled",syncDuplicateSongs:!1,defaultRating:"2.5"};settings={};try{var t=JSON.parse(z("starRatings:settings"));if(!t||"object"!=typeof t)throw"";settings=t}catch{return R("starRatings:settings",e),e}let a=!1;for(const i of Object.keys(e))settings.hasOwnProperty(i)||(settings[i]=e[i],a=!0);return a&&R("starRatings:settings",settings),settings}()),await Ke();const e={"5.0":Spicetify.Keyboard.KEYS.NUMPAD_0,.5:Spicetify.Keyboard.KEYS.NUMPAD_1,"1.0":Spicetify.Keyboard.KEYS.NUMPAD_2,1.5:Spicetify.Keyboard.KEYS.NUMPAD_3,"2.0":Spicetify.Keyboard.KEYS.NUMPAD_4,2.5:Spicetify.Keyboard.KEYS.NUMPAD_5,"3.0":Spicetify.Keyboard.KEYS.NUMPAD_6,3.5:Spicetify.Keyboard.KEYS.NUMPAD_7,"4.0":Spicetify.Keyboard.KEYS.NUMPAD_8,4.5:Spicetify.Keyboard.KEYS.NUMPAD_9},l=Se(e),o=(t=e,()=>{for(const e of Object.values(t))Spicetify.Keyboard._deregisterShortcut({key:e,ctrl:!0,alt:!0})});var t;const s=()=>{S&&S[0].remove(),w=null,Ne(e)};new Spicetify.Menu.Item("Star Ratings",!0,()=>{var e,t,a,i,r,n;Spicetify.PopupModal.display({title:"Star Ratings",content:({settings:e,registerKeyboardShortcuts:t,deregisterKeyboardShortcuts:a,updateTracklist:i,restoreTracklist:r,redrawNowPlayingStars:n}=[{settings:f,registerKeyboardShortcuts:l,deregisterKeyboardShortcuts:o,updateTracklist:Ee,restoreTracklist:ke,redrawNowPlayingStars:s}][0],d.createElement("div",null,d.createElement(ie,{value:"Settings"}),d.createElement(_,{settings:e,name:"Half star ratings",field:"halfStarRatings"}),d.createElement(_,{settings:e,name:"Enable keyboard shortcuts",field:"enableKeyboardShortcuts",onclick:function(){(e.enableKeyboardShortcuts?t:a)()}}),d.createElement(_,{settings:e,name:"Show playlist stars",field:"showPlaylistStars",onclick:function(){(e.showPlaylistStars?i:r)()}}),d.createElement(ae,{settings:e,name:"Auto-like/dislike threshold",field:"likeThreshold",options:{Disabled:"disabled","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"}}),d.createElement(ae,{settings:e,name:"Now playing stars position",field:"nowPlayingStarsPosition",options:{Left:"left",Right:"right"},onclick:function(){n()}}),d.createElement(ae,{settings:e,name:"Skip threshold",field:"skipThreshold",options:{Disabled:"disabled","0.0":"0.0",.5:"0.5","1.0":"1.0",1.5:"1.5","2.0":"2.0",2.5:"2.5","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5"}}),d.createElement(_,{settings:e,name:d.createElement(d.Fragment,null,"Sync duplicate songs with same rating",d.createElement("br",null),"(Does not apply to songs that have already been rated)"),field:"syncDuplicateSongs"}),d.createElement(ae,{settings:e,name:"Default rating for unrated songs",field:"defaultRating",options:{"0.0":"0.0",.5:"0.5","1.0":"1.0",1.5:"1.5","2.0":"2.0",2.5:"2.5","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"}}),d.createElement(ie,{value:"Keyboard Shortcuts"}),d.createElement("ul",null,d.createElement(U,{label:"Rate current track 0.5 stars",numberKey:"1"}),d.createElement(U,{label:"Rate current track 1 star",numberKey:"2"}),d.createElement(U,{label:"Rate current track 1.5 stars",numberKey:"3"}),d.createElement(U,{label:"Rate current track 2 stars",numberKey:"4"}),d.createElement(U,{label:"Rate current track 2.5 stars",numberKey:"5"}),d.createElement(U,{label:"Rate current track 3 stars",numberKey:"6"}),d.createElement(U,{label:"Rate current track 3.5 stars",numberKey:"7"}),d.createElement(U,{label:"Rate current track 4 stars",numberKey:"8"}),d.createElement(U,{label:"Rate current track 4.5 stars",numberKey:"9"}),d.createElement(U,{label:"Rate current track 5 stars",numberKey:"0"})))),isLarge:!0})}).register(),c=new MutationObserver(()=>{Ee()}),Spicetify.Player.addEventListener("songchange",()=>{var e=Spicetify.Player.data.item.uri;e in m&&"disabled"!==f.skipThreshold&&m[e]<=parseFloat(f.skipThreshold)?Spicetify.Player.next():(Pe(),N&&setTimeout(()=>ye(),1e3))}),Spicetify.Platform.History.listen(async()=>{await Ce()}),new Spicetify.ContextMenu.Item("Use as Rated folder",e=>{I(u=e[0]),k=!0,Ke().finally(()=>{k=!1})},Re).register(),new Spicetify.ContextMenu.Item("Sort by rating",e=>{var t,a;Spicetify.PopupModal.display({title:"Modify Custom order?",content:({onClickCancel:t,onClickOK:a}=[{onClickCancel:()=>{Spicetify.PopupModal.hide()},onClickOK:()=>{Spicetify.PopupModal.hide(),E=!0,P("Sorting..."),ce(e[0],m).finally(()=>{E=!1})}}][0],i.createElement("div",{className:"parent-div"},i.createElement("p",null,"This will modify the ",i.createElement("b",null,"Custom order")," of the playlist."),i.createElement("div",{className:"button-div"},i.createElement(re,{name:"Cancel",className:"cancel-button",onButtonClick:t}),i.createElement(re,{name:"Sort",className:"ok-button",onButtonClick:a}))))})},Ae).register(),new Spicetify.ContextMenu.Item("Create weighted shuffle",e=>{const t=e[0];Spicetify.PopupModal.display({title:"Create Weighted Shuffle Playlist",content:oe({onClickCancel:()=>{Spicetify.PopupModal.hide()},onClickCreate:async e=>{Spicetify.PopupModal.hide(),P("Creating weighted shuffle...");try{P(await ge(t,e)?`Weighted shuffle playlist created with ${e} tracks!`:"Failed to create weighted shuffle playlist")}catch(e){console.error("Error creating weighted shuffle playlist:",e),P("Error creating weighted shuffle playlist")}}})})},Ae).register();var a=new MutationObserver(async()=>{await Ne(e)});await Ne(e),a.observe(document.body,{childList:!0,subtree:!0})},(async()=>{await q()})();function P(e){Spicetify.showNotification(e)}function z(e){return Spicetify.LocalStorage.get(e)}function R(e,t){Spicetify.LocalStorage.set(e,t)}function H(){var e=Array.from(Spicetify.Platform.Registry._map?.values?.())?.[40];return Spicetify.Platform.LibraryAPI??e?.instance}function F(){var e=Array.from(Spicetify.Platform.Registry._map?.values?.())?.[41];return Spicetify.Platform.RootlistAPI??e?.instance}function A(){var e=Array.from(Spicetify.Platform.Registry._map?.values?.())?.[42];return Spicetify.Platform.PlaylistAPI??e?.instance}async function K(e,t){var t=navigator.platform.startsWith("Linux")&&navigator.userAgent.includes("Spotify/1.1.84.716")?{after:t}:{after:{uri:t}},a=Spicetify.User?.getUsername?.()??Spicetify.Platform.username;return Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/users/${a}/playlists`,{name:e,...t})}async function Y(e){setTimeout(async()=>{await Spicetify.CosmosAsync.post(`sp://core-playlist/v1/playlist/${e}/set-base-permission`,{permission_level:"BLOCKED"})},1e3)}async function W(e){return Spicetify.CosmosAsync.get("https://api.spotify.com/v1/albums/"+e,{offset:0,limit:450})}async function $(){return F().getContents()}async function V(e){(await H().contains(e))[0]||await H().add({uris:[e],silent:0})}async function G(e,t){await A().remove(e,[{uri:t,uid:""}])}async function L(e){return(await Spicetify.CosmosAsync.get("sp://core-playlist/v1/playlist/"+e)).items}async function J(e){return 1===(await Spicetify.CosmosAsync.get("sp://desktop/v1/version")).version.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})}async function X(e){e=(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/tracks/"+e)).external_ids.isrc;return(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/search",{q:"isrc:"+e,type:"track",limit:50})).tracks.items}function Q(e,t){var a,i,r,n=document.createElement("span"),l="stars-"+e,o=(n.className="stars",n.id=l,n.style.whiteSpace="nowrap",n.style.alignItems="center",n.style.display="flex",[]);for(let e=0;e<5;e++){d=l,a=e+1,c=t,r=i=s=void 0,s="http://www.w3.org/2000/svg",i=document.createElementNS(s,"svg"),d=d+"-"+a,i.id=d,i.style.minHeight=c+"px",i.style.minWidth=c+"px",i.setAttributeNS(null,"width",c+"px"),i.setAttributeNS(null,"height",c+"px"),i.setAttributeNS(null,"viewBox","0 0 32 32"),a=document.createElementNS(s,"defs"),i.append(a),c=document.createElementNS(s,"linearGradient"),a.append(c),c.id=d+"-gradient",a=document.createElementNS(s,"stop"),c.append(a),a.id=d+"-gradient-first",a.setAttributeNS(null,"offset","50%"),a.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r=document.createElementNS(s,"stop"),c.append(r),r.id=d+"-gradient-second",r.setAttributeNS(null,"offset","50%"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),d=document.createElementNS(s,"path"),i.append(d),d.setAttributeNS(null,"fill",`url(#${c.id})`),d.setAttributeNS(null,"d","M20.388,10.918L32,12.118l-8.735,7.749L25.914,31.4l-9.893-6.088L6.127,31.4l2.695-11.533L0,12.118l11.547-1.2L16.026,0.6L20.388,10.918z");var[s,c,d]=[i,a,r];n.append(s),o.push([s,c,d])}return[n,o]}function M(t,e){var a=e/=.5;for(let e=0;e<5;e++){var i=t[e][1],r=t[e][2];i.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)")}for(let e=0;e<a;e++){var n=Math.floor(e/2),l=t[n][1],n=t[n][2];(e%2==0?l:n).setAttributeNS(null,"stop-color","var(--spice-button)")}}function Z(e,t,a){t=t.getBoundingClientRect(),t=event.clientX-t.left;let i=a+1;return 8<t||!e.halfStarRatings||(i-=.5),0===a&&t<3&&(i-=e.halfStarRatings?.5:1),i}function ee(e){R("starRatings:settings",JSON.stringify(e))}function T(e){R("starRatings:playlistUris",JSON.stringify(e))}function I(e){R("starRatings:ratedFolderUri",e)}function te(){return d.createElement("svg",{width:16,height:16,viewbox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:Spicetify.SVGIcons.check}})}function _({settings:t,name:e,field:a,onclick:i}){let[r,n]=Spicetify.React.useState(t[a]);var l=r?"checkbox":"checkbox disabled";return d.createElement("div",{className:"popup-row"},d.createElement("label",{className:"col description"},e),d.createElement("div",{className:"col action"},d.createElement("button",{className:l,onClick:function(){var e=!r;t[a]=e,n(e),ee(t),i&&i()}},d.createElement(te,null))))}function ae({settings:t,name:e,field:a,options:i,onclick:r}){const[n,l]=Spicetify.React.useState(t[a]);var o,s,c=[];for([o,s]of Object.entries(i))c.push(d.createElement("option",{value:s},o));return d.createElement("div",{className:"popup-row"},d.createElement("label",{className:"col description"},e),d.createElement("div",{className:"col action"},d.createElement("select",{value:n,onChange:function(e){l(e.target.value),t[a]=e.target.value,ee(t),r&&r()}},c)))}function U({label:e,numberKey:t}){return d.createElement("li",{className:"main-keyboardShortcutsHelpModal-sectionItem"},d.createElement("span",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-sectionItemName"},e),d.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Ctrl"),d.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Alt"),d.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},t))}function ie({value:e}){return d.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},e)}function re({name:e,className:t,onButtonClick:a}){return i.createElement("button",{className:t,onClick:a},e)}function ne({name:e,className:t,onButtonClick:a}){return r.createElement("button",{className:t,onClick:a},e)}function le({value:e,onChange:t}){return r.createElement("div",{className:"weighted-playlist-input-container"},r.createElement("input",{type:"text",value:e,onChange:t,className:"weighted-playlist-input",placeholder:"Enter number of tracks (e.g., 100, 500, 1000)"}))}function oe({onClickCancel:e,onClickCreate:t}){const[a,i]=r.useState("10");return r.createElement("div",{className:"weighted-playlist-modal"},r.createElement("div",{className:"weighted-playlist-modal-content"},r.createElement("h3",{className:"weighted-playlist-modal-title"},"Create Weighted Shuffle Playlist"),r.createElement("p",{className:"weighted-playlist-modal-description"},"Select how many tracks you want in your weighted shuffle playlist. Tracks will be chosen using the same weighted random selection as the queue system."),r.createElement("div",{className:"weighted-playlist-input-section"},r.createElement("label",{className:"weighted-playlist-label"},"Number of tracks:"),r.createElement(le,{value:a,onChange:function(e){i(e)}})),r.createElement("div",{className:"weighted-playlist-suggested"},r.createElement("span",{className:"weighted-playlist-suggested-label"},"Suggested:"),r.createElement("div",{className:"weighted-playlist-suggested-buttons"},[10,25,50,100,250,500,1e3,2e3,5e3].map(e=>r.createElement("button",{key:e,className:"weighted-playlist-suggested-btn "+(a===e.toString()?"active":""),onClick:()=>i(e.toString())},e)))),r.createElement("div",{className:"weighted-playlist-preview"},r.createElement("span",{className:"weighted-playlist-preview-text"},"Preview: Your playlist will contain ",a," tracks, selected randomly based on ratings with higher-rated tracks having higher probability.")),r.createElement("div",{className:"weighted-playlist-button-div"},r.createElement(ne,{name:"Cancel",className:"weighted-playlist-cancel-button",onButtonClick:e}),r.createElement(ne,{name:"Create Playlist",className:"weighted-playlist-create-button",onButtonClick:function(){var e=parseInt(a);isNaN(e)||e<=0?alert("Please enter a valid positive number"):t(e)}}))))}function se(e,t){return e.items.find(e=>"folder"===e.type&&e.name===t)}async function ce(a,i){const r=["5.0","4.5","4.0","3.5","3.0","2.5","2.0","1.5","1.0","0.5","0.0"];var n=await L(a);if(0!==n.length){var l={};for(const p of r)l[p]=[];for(const f of n){let e=i[f.link]??0;l[e="number"==typeof e?e.toFixed(1):e].push(f.rowId)}let e=function(e){for(const t of r)if(0<e[t].length)return e[t][0];return null}(l);var o,s,c,d,n=n[0].rowId,u=e===n;let t=!0;for(const m of r)0!==l[m].length&&(!u&&t?(o=a,s=l[m],c=e,d=void 0,d=await J("1.2.5.1006.g22820f93"),await A().move(o,s.map(e=>({uid:e})),{before:d?{uid:c}:c})):(o=a,s=l[m],d=e,c=void 0,c=await J("1.2.5.1006.g22820f93"),await A().move(o,s.map(e=>({uid:e})),{after:c?{uid:d}:d})),t=!1,e=l[m].slice(-1)[0])}}function de(){var e=Spicetify.Platform.History.location.pathname.match(/album\/(.*)/);return e?e[1]:null}function ue(e){return e.replace("spotify:track:","")}function pe(e){e=m[e];return e?parseFloat(e):parseFloat(f.defaultRating)}function fe(){return new Promise(async a=>{try{var t=Spicetify.Player.getContext();if(t&&t.uri){let e=[];if(t.uri.includes("playlist")){var i=t.uri;e=(s=(s=i).split(":").pop(),await(await Spicetify.CosmosAsync.get(`https://api.spotify.com/v1/playlists/${s}/tracks`)).items.map(e=>({uri:e.track.uri,link:e.track.uri,name:e.track.name,artists:e.track.artists.map(e=>e.name).join(", ")})))}else{if(!t.uri.includes("album"))return void a(null);var r=await W(t.uri.split(":").pop());e=r.tracks.items.map(e=>({uri:e.uri,link:e.uri}))}if(0===e.length)a(null);else{const c=Spicetify.Player.data.item?.uri,d=await me();var n=e.filter(t=>t.link!==c&&!d.some(e=>e.uri===t.link));if(0===n.length)a(null);else{var l=n.map(e=>pe(e.link)),o=l.reduce((e,t)=>e+t,0);if(o<=0)a(null);else{let t=Math.random()*o;for(let e=0;e<n.length;e++)if((t-=l[e])<=0)return void a(n[e].link);a(n[n.length-1].link)}}}}else a(null)}catch(e){console.error("Error in weighted track selection:",e),a(null)}var s})}async function me(){try{return(await Spicetify.CosmosAsync.get("sp://player/v1/queue"))?.queue||[]}catch{return[]}}async function ye(){if(N&&C)try{await((await me()).length<=1)&&async function(){if(!N)return;try{var e=await fe();e&&e!==j&&(await Spicetify.CosmosAsync.post("sp://player/v1/queue",{trackUri:e,playNow:!1}),j=e)}catch(e){return!console.error("Error adding weighted track to queue:",e)}}()}catch(e){console.error("Error in weighted playback:",e)}}async function ge(e,t){try{d=(d=e).split(":").pop();var i=(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/playlists/"+d)).name+` (Weighted ${t})`;let a;try{a=await K(i,u)}catch(e){let t=1;for(;t<=100;)try{a=await K(i+` (${t})`,u);break}catch(e){t++}if(!a)throw new Error("Unable to create weighted shuffle playlist")}var r=await L(e);if(0!==r.length){var n=r.map(e=>({uri:e.link,weight:pe(e.link)})).filter(e=>0<e.weight);if(0===n.length)throw new Error("No tracks with valid weights found");var l=function(t,a){var i=[];for(let e=0;e<a;e++){var r=t.reduce((e,t)=>e+t.weight,0);if(r<=0)break;let e=Math.random()*r;for(const n of t)if((e-=n.weight)<=0){i.push(n);break}}return i}(n,t);if(0===l.length)throw new Error("No tracks could be selected");for(let e=0;e<l.length;e+=50){var o=l.slice(e,e+50).map(e=>e.uri);s=a.uri,c=o,s=s.split(":").pop(),await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${s}/tracks`,{uris:c})}}return a}catch(e){return console.error("Error creating weighted shuffle playlist:",e),null}var s,c,d}function he(){var e=function(e,t){if(console.log("album is:",t),!t)return"0.0";let a=0,i=0;for(const l of t.tracks.items){var r=l.uri,r=parseFloat(e[r]);r&&(a+=r,i+=1)}let n=0;return 0<i&&(n=a/i),(n=Math.round(2*n)/2).toFixed(1)}(m,t);M(s[1],e)}async function be(e,t){delete m[e];var t=g[t],a=y[t];await G(t,e),P("Removed from "+a)}async function ve(e,t,i,r=!0){try{var n;m[e]=i,t&&await G(g[t],e),u||(await F().createFolder("Rated",{before:""}),n=se(await $(),"Rated"),I(u=n.uri));let a=g[i];var l=i;if(a){if(8e3<=(await L(a)).length){let t=1,e;for(;;)try{var o=`${i}(${t})`;await Y(e=await K(o,u));break}catch(e){if(100<++t)throw new Error("Unable to create overflow playlist")}a=e,g[i]=e,T(g),y[e]=`${i}(${t})`}}else await Y(a=await K(l,u)),g[i]=a,T(g),y[a]=l;s=a,c=e,await A().add(s,[c],{after:1,before:0}),P((t?"Moved":"Added")+" to "+y[a]),"disabled"!==f.likeThreshold&&r&&parseFloat(f.likeThreshold)<=parseFloat(i)&&await V(e)}catch(e){console.error("Error in handleSetRating:",e),P("Error updating rating: "+(e.message||"Unknown error"))}var s,c}function we(l,o,s,c){return()=>{if(!(x||k||E)){x=!0;var[,i]=s,i=i[l][0];const r=c(),n=m[r];let a=null!==o?o:Z(f,i,l).toFixed(1),e=null,t=null;n===a?(t=0,e=be(r,a),f.syncDuplicateSongs&&(async()=>{try{for(const t of await X(r.substring(14))){var e=t.uri;e in m&&await be(e,m[e])}}catch(e){console.error(e)}})()):(t=a,e=ve(r,n,a),"disabled"!==f.likeThreshold&&a>=parseFloat(f.likeThreshold)&&V(r),f.syncDuplicateSongs&&(async()=>{try{for(const t of await X(r.substring(14))){var e=t.uri;await ve(e,m[e],a,!1)}}catch(e){console.error(e)}})()),e.finally(()=>{var e=function(e){var t="stars-"+e;if(!(e=document.getElementById(t)))return null;var a=[];for(let e=1;e<=5;e++){var i=t+"-"+e,r=document.getElementById(i),n=document.getElementById(i+"-gradient-first"),i=document.getElementById(i+"-gradient-second");a.push([r,n,i])}return[e,a]}(ue(r));e&&(M(e[1],t),e[0].style.visibility=n===a?"hidden":"visible"),Pe(),x=!1})}}}function Se(a){return()=>{for(var[e,t]of Object.entries(a))Spicetify.Keyboard.registerShortcut({key:t,ctrl:!0,alt:!0},we(0,parseFloat(e),S,B))}}function xe(e,a){const[t,i]=e;t.addEventListener("mouseout",function(){var e;M(i,(e=a(),m[e]??0))});for(let t=0;t<5;t++){const r=i[t][0];r.addEventListener("mousemove",function(){var e=Z(f,r,t);M(i,e)}),r.addEventListener("click",we(t,null,e,a))}}function ke(){document.querySelectorAll(".main-trackList-trackListHeaderRow").forEach(e=>{e.style["grid-template-columns"]=h});for(const i of Array.from(v)){var e=i.getElementsByClassName("main-trackList-trackListRow");for(const r of Array.from(e)){var t,a=r.querySelector(".starRatings");a&&(r.style["grid-template-columns"]=b,a.remove(),a=r.querySelector(".main-trackList-rowSectionEnd"),t=parseInt(a.getAttribute("aria-colindex")),a.setAttribute("aria-colindex",(t-1).toString()))}}}function Ee(){if(f.showPlaylistStars){a=v;let t=(v=Array.from(document.querySelectorAll(".main-trackList-indexable"))).length!==a.length;for(let e=0;e<v.length;e++)v[e].isEqualNode(a[e])||(t=!0);t&&(b=h=null);{var e=v;let a=null;var i=document.querySelectorAll(".main-trackList-trackListHeaderRow");i.forEach(e=>{var t=e.querySelector(".main-trackList-rowSectionEnd"),t=parseInt(t.getAttribute("aria-colindex"));(h=h||getComputedStyle(e).gridTemplateColumns)&&p[t]&&(e.style["grid-template-columns"]=p[t],a=p[t])});for(const s of e)for(const c of s.getElementsByClassName("main-trackList-trackListRow")){var r=0<c.getElementsByClassName("stars").length;const d=function(e){return(e=Object.values(e))?(e=e[0]?.pendingProps?.children?.[0]?.props?.children??e[0]?.pendingProps?.children?.props?.value?.item)?.uri||e?.props?.uri||e?.props?.children?.props?.uri||e?.props?.children?.props?.children?.props?.uri||e?.[0]?.props?.uri:null}(c);var n=d.includes("track");let e=c.querySelector(".starRatings");if(e||(l=c.querySelector(".main-trackList-rowSectionEnd"),o=parseInt(l.getAttribute("aria-colindex")),l.setAttribute("aria-colindex",(o+1).toString()),(e=document.createElement("div")).setAttribute("aria-colindex",o.toString()),e.role="gridcell",e.style.display="flex",e.classList.add("main-trackList-rowSectionVariable"),e.classList.add("starRatings"),c.insertBefore(e,l),b=b||getComputedStyle(c).gridTemplateColumns,p[o]&&(c.style["grid-template-columns"]=a||p[o])),d&&!r&&n){var l=Q(ue(d),16);const u=l[0];var o=l[1],r=m[d]??0;e.appendChild(u),M(o,r),xe(l,()=>d),u.style.visibility=void 0!==m[d]?"visible":"hidden",c.addEventListener("mouseover",()=>{u.style.visibility="visible"}),c.addEventListener("mouseout",()=>{u.style.visibility=void 0!==m[d]?"visible":"hidden"})}}}}}async function Ne(e){n=l,(l=document.querySelector("main"))&&!l.isEqualNode(n)&&(n&&c.disconnect(),Ee(),c.observe(l,{childList:!0,subtree:!0})),D=w;var t="left"===f.nowPlayingStarsPosition?".main-nowPlayingWidget-nowPlaying .main-trackInfo-container":".main-nowPlayingBar-right div",t=((w=document.querySelector(t))&&!w.isEqualNode(D)&&((S=Q("now-playing",16))[0].style.marginLeft="8px",S[0].style.marginRight="8px","left"===f.nowPlayingStarsPosition?w.after(S[0]):w.prepend(S[0]),xe(S,B),Pe(),f.enableKeyboardShortcuts)&&Se(e)(),O=o,(o=document.querySelector(".main-actionBar-ActionBar .ix_8kg3iUb9VS5SmTnBY"))&&!o.isEqualNode(O)&&null!==de()&&(s=Q("album",32),o.after(s[0]),await Ce()),document.querySelector('[data-testid="control-button-shuffle"]'));if(t&&!t.nextElementSibling?.classList.contains("weighted-shuffle-button")){const a=document.createElement("button");a.className="weighted-shuffle-button",a.style.cssText=`
            margin-left: 8px;
            background: transparent;
            border: 1px solid var(--essential-subdued, #878787);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-subdued, #6a6a6a);
        `,a.innerHTML=`
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M13.5 2.5c-.66 0-1.3.26-1.77.73L9.24 5.72h2.76c.41 0 .75.34.75.75s-.34.75-.75.75h-3.16c-.41 0-.75-.34-.75-.75v-3.16c0-.41.34-.75.75-.75s.75.34.75.75v2.76l2.49-2.49c.47-.47 1.11-.73 1.77-.73s1.3.26 1.77.73l1.34 1.34a.25.25 0 0 1-.18.43h-1.6a.75.75 0 0 0-.67.43l-.34.67a.25.25 0 0 1-.23.15h-.76a.25.25 0 0 1-.25-.25v-.67c0-.41-.34-.75-.75-.75s-.75.34-.75.75v.42a.25.25 0 0 1-.23.15h-.84a.25.25 0 0 1-.22-.15l-.34-.67a.75.75 0 0 0-.67-.43H8.67a.75.75 0 0 0-.67.43l-.34.67a.25.25 0 0 1-.23.15H7.1a.25.25 0 0 1-.25-.25V7.8c0-.41-.34-.75-.75-.75s-.75.34-.75.75v.42a.25.25 0 0 1-.23.15H4.28a.25.25 0 0 1-.18-.43l1.34-1.34c.47-.47 1.11-.73 1.77-.73s1.3.26 1.77.73l2.49 2.49V2.25c0-.41.34-.75.75-.75s.75.34.75.75v3.16c0 .41-.34.75-.75.75h-2.76l2.49 2.49c.47.47.73 1.11.73 1.77s-.26 1.3-.73 1.77l-1.34 1.34a.25.25 0 0 1-.43-.18v-1.6a.75.75 0 0 0-.43-.67l-.67-.34a.25.25 0 0 1-.15-.23v-.76c0-.13.1-.25.25-.25h.67c.41 0 .75-.34.75-.75s-.34-.75-.75-.75h-.42a.25.25 0 0 1-.15-.23v-.84c0-.13.1-.25.25-.25h.76c.13 0 .25-.1.25-.25v-.84c0-.13.1-.25.25-.25h.67c.13 0 .25-.1.25-.25v-.76c0-.13.1-.25.25-.25h.84c.13 0 .25-.1.25-.25v-.67c0-.13.1-.25.25-.25h1.6a.25.25 0 0 1 .18.43l-1.34 1.34c-.47.47-1.11.73-1.77.73s-1.3-.26-1.77-.73L8.2 10.22V7.06c0-.41.34-.75.75-.75h3.16c.41 0 .75.34.75.75v2.76l-2.49 2.49c-.47.47-1.11.73-1.77.73s-1.3-.26-1.77-.73l-1.34-1.34a.25.25 0 0 1 .18-.43h1.6c.13 0 .25-.1.25-.25v-.76c0-.13.1-.25.25-.25h.67c.13 0 .25-.1.25-.25v-.84c0-.13.1-.25.25-.25h.84c.13 0 .25-.1.25-.25v-.67c0-.13.1-.25.25-.25h.76c.13 0 .25-.1.25-.25v-.84c0-.13.1-.25.25-.25h1.6c.13 0 .25-.1.25-.25z"/>
                <path d="M12.82 3.18l-.76-.76-3.03 3.03.76.76 3.03-3.03z"/>
                <path d="M9.03 6.45l-.76-.76-2.12 2.12.76.76 2.12-2.12z"/>
            </svg>
        `,a.title="Weighted Shuffle",a.addEventListener("click",()=>{N=!N,a.style.backgroundColor=N?"var(--background-press, #1db954)":"transparent",a.style.borderColor=N?"var(--background-press, #1db954)":"var(--essential-subdued, #878787)",a.style.color=N?"white":"var(--text-subdued, #6a6a6a)",a.title=N?"Disable Weighted Shuffle":"Enable Weighted Shuffle",N&&!C?(C=!0,ye()):N||(C=!1),showNotification(N?"Weighted shuffle enabled":"Weighted shuffle disabled")}),t.parentNode.insertBefore(a,t.nextSibling)}}async function Ce(){s&&(e=de(),s[0].style.display=e?"flex":"none",console.log("albumId is:",e),e)&&(t=await W(e),he())}function Pe(){var e,t;S&&(t=(e=Spicetify.Player.data.item.uri).includes("track"),S[0].style.display=t?"flex":"none",t=m[e]??0,M(S[1],t))}function Re(e){return Spicetify.URI.fromString(e[0]).type===Spicetify.URI.Type.FOLDER}function Ae(e){switch(Spicetify.URI.fromString(e[0]).type){case Spicetify.URI.Type.PLAYLIST:case Spicetify.URI.Type.PLAYLIST_V2:return!0}return!1}async function Ke(){u=z("starRatings:ratedFolderUri"),m={},y={},g=function(){try{var e=JSON.parse(z("starRatings:playlistUris"));if(e&&"object"==typeof e)return e;throw""}catch{return R("starRatings:playlistUris","{}"),{}}}();let e=null;var t,a,i,r;u?(t=await $(),e=(a=u,t.items.find(e=>"folder"===e.type&&e.uri===a))):(t=await $(),(e=se(t,"Rated"))&&I(u=e.uri)),e?(i=!1,[i,g]=function(e,t){var a={};let i=!1;for(const[r,n]of Object.entries(e))t.items.find(e=>e.uri===n)?a[r]=n:i=!0;return[i,a]}(g,e),r=!1,[r,g]=function(t,e){const a={...t};let i=!1;const r=["0.0","0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"].filter(e=>!t.hasOwnProperty(e));return e.items.filter(e=>r.includes(e.name)).forEach(e=>{a[e.name]=e.uri,i=!0}),[i,a]}(g,e),(r||i)&&T(g),r=await async function(t){var a=Object.keys(t),i=await Promise.all(a.map(e=>L(t[e]))),r={};for(let e=0;e<a.length;e++)r[a[e]]=i[e];return r}(g),m=function(e){var t,a,i={};for([t,a]of Object.entries(e))for(const r of a)i[r.link]=t;return i}(r),y=function(t,e){const a={};return e.items.filter(e=>Object.values(t).includes(e.uri)).forEach(e=>{a[e.uri]=e.name}),a}(g,e)):0<Object.keys(g).length&&(T(g={}),I(u=""))}(async()=>{var e;document.getElementById("starDratings")||((e=document.createElement("style")).id="starDratings",e.textContent=String.raw`
  .popup-row::after{content:"";display:table;clear:both}.popup-row .col{display:flex;padding:10px 0;align-items:center}.popup-row .col.description{float:left;padding-right:15px}.popup-row .col.action{float:right;text-align:right}.popup-row .div-title{color:var(--spice-text)}.popup-row .divider{height:2px;border-width:0;background-color:var(--spice-button-disabled)}.popup-row .space{margin-bottom:20px;visibility:hidden}button.checkbox{align-items:center;border:0;border-radius:50%;background-color:rgba(var(--spice-rgb-shadow),.7);color:var(--spice-text);cursor:pointer;display:flex;margin-inline-start:12px;padding:8px}button.checkbox.disabled{color:rgba(var(--spice-rgb-text),.3)}select{color:var(--spice-text);background:rgba(var(--spice-rgb-shadow),.7);border:0;height:32px}::-webkit-scrollbar{width:8px}.login-button{background-color:var(--spice-button);border-radius:8px;border-style:none;box-sizing:border-box;color:var(--spice-text);cursor:pointer;display:inline-block;font-size:14px;font-weight:500;height:40px;line-height:20px;list-style:none;margin:10px;outline:0;padding:5px 10px;position:relative;text-align:center;text-decoration:none;vertical-align:baseline;touch-action:manipulation}.parent-div{display:flex;flex-direction:column;gap:8px}.button-div{margin-top:24px;display:flex;gap:16px;justify-content:flex-end}.cancel-button{background-color:transparent;font-weight:700;border:0;color:var(--spice-text);display:inline-flex;border-radius:500px;font-size:inherit;min-block-size:48px;align-items:center;padding-inline:32px}.cancel-button:hover{transform:scale(1.04)}.ok-button{background-color:var(--spice-button-active);font-weight:700;border:0;color:var(--spice-main);display:inline-flex;border-radius:500px;font-size:inherit;min-block-size:48px;align-items:center;padding-inline:32px}.ok-button:hover{transform:scale(1.04)}.weighted-playlist-modal{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000}.weighted-playlist-modal-content{background-color:var(--background-base,#121212);border-radius:8px;padding:24px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}.weighted-playlist-modal-title{margin:0 0 16px 0;color:var(--text-base,#fff);font-size:20px;font-weight:600;font-family:Inter,sans-serif}.weighted-playlist-modal-description{margin:0 0 24px 0;color:var(--text-subdued,#b3b3b3);font-size:14px;line-height:1.5}.weighted-playlist-input-section{margin-bottom:20px}.weighted-playlist-label{display:block;margin-bottom:8px;color:var(--text-base,#fff);font-size:14px;font-weight:500}.weighted-playlist-input-container{display:flex;align-items:center}.weighted-playlist-input{background-color:var(--background-elevated-base,#181818);border:1px solid var(--essential-subdued,#727272);border-radius:4px;padding:8px 12px;color:var(--text-base,#fff);font-size:14px;width:200px;text-align:left;font-family:Inter,sans-serif}.weighted-playlist-input:focus{outline:0;border-color:var(--background-tinted-accent,#1db954);box-shadow:0 0 0 1px var(--background-tinted-accent,#1db954)}.weighted-playlist-input::-moz-placeholder{color:var(--text-subdued,#b3b3b3)}.weighted-playlist-input::placeholder{color:var(--text-subdued,#b3b3b3)}.weighted-playlist-suggested{margin-bottom:20px}.weighted-playlist-suggested-label{display:block;margin-bottom:8px;color:var(--text-subdued,#b3b3b3);font-size:12px;text-transform:uppercase;letter-spacing:.5px;font-weight:600}.weighted-playlist-suggested-buttons{display:flex;gap:8px;flex-wrap:wrap}.weighted-playlist-suggested-btn{background-color:var(--background-tinted-base,#535353);border:none;border-radius:16px;color:var(--text-base,#fff);padding:6px 12px;font-size:12px;cursor:pointer;transition:background-color .2s ease;font-family:Inter,sans-serif;font-weight:500}.weighted-playlist-suggested-btn:hover{background-color:var(--background-tinted-hover,#6a6a6a)}.weighted-playlist-suggested-btn.active{background-color:var(--background-tinted-accent,#1db954)}.weighted-playlist-preview{background-color:var(--background-tinted-base,#181818);border-radius:4px;padding:12px;margin-bottom:24px}.weighted-playlist-preview-text{color:var(--text-subdued,#b3b3b3);font-size:13px;line-height:1.4}.weighted-playlist-button-div{display:flex;justify-content:flex-end;gap:12px}.weighted-playlist-cancel-button,.weighted-playlist-create-button{background-color:transparent;border:1px solid var(--essential-subdued,#878787);border-radius:20px;padding:8px 16px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;cursor:pointer;transition:all .2s ease;font-family:Inter,sans-serif}.weighted-playlist-cancel-button{color:var(--text-subdued,#b3b3b3)}.weighted-playlist-cancel-button:hover{border-color:var(--text-base,#fff);color:var(--text-base,#fff)}.weighted-playlist-create-button{background-color:var(--background-tinted-accent,#1db954);border-color:var(--background-tinted-accent,#1db954);color:var(--text-base,#fff)}.weighted-playlist-create-button:hover{background-color:var(--background-tinted-accent-hover,#1ed760);border-color:var(--background-tinted-accent-hover,#1ed760)}@media (max-width:600px){.weighted-playlist-modal-content{width:95%;padding:20px}.weighted-playlist-suggested-buttons{gap:6px}.weighted-playlist-suggested-btn{padding:4px 10px;font-size:11px}}
      `.trim(),document.head.appendChild(e))})()}();