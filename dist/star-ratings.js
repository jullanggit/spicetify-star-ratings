!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var d,i,r,p,U,f,u,m,y,g,b,h,n,o,c,v,a,D,w,B,l,e,t,s,S,k,x,E,N,O;d=Spicetify.React,i=Spicetify.React,r=Spicetify.React,p=[null,null,null,null,"[index] 16px [first] 4fr [var1] 2fr [var2] 1fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] 2fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] minmax(120px,2fr) [var3] 2fr [last] minmax(120px,1fr)"],U=()=>Spicetify.Player.data.item.uri,m={},y={},g={},v=[],S=s=t=e=l=B=w=D=c=o=n=h=b=u=f=null,N=E=x=k=!(a=[]),O=async function(){for(;!Spicetify?.showNotification;)await new Promise(e=>setTimeout(e,100));Z(f=function(){var e={halfStarRatings:!0,likeThreshold:"4.0",enableKeyboardShortcuts:!0,showPlaylistStars:!0,nowPlayingStarsPosition:"left",skipThreshold:"disabled",syncDuplicateSongs:!1,defaultRating:"2.5",reEnqueueWorkaround:!1};settings={};try{var t=JSON.parse(j("starRatings:settings"));if(!t||"object"!=typeof t)throw"";settings=t}catch{return C("starRatings:settings",e),e}let a=!1;for(const i of Object.keys(e))settings.hasOwnProperty(i)||(settings[i]=e[i],a=!0);return a&&C("starRatings:settings",settings),settings}()),await Re();const e={"5.0":Spicetify.Keyboard.KEYS.NUMPAD_0,.5:Spicetify.Keyboard.KEYS.NUMPAD_1,"1.0":Spicetify.Keyboard.KEYS.NUMPAD_2,1.5:Spicetify.Keyboard.KEYS.NUMPAD_3,"2.0":Spicetify.Keyboard.KEYS.NUMPAD_4,2.5:Spicetify.Keyboard.KEYS.NUMPAD_5,"3.0":Spicetify.Keyboard.KEYS.NUMPAD_6,3.5:Spicetify.Keyboard.KEYS.NUMPAD_7,"4.0":Spicetify.Keyboard.KEYS.NUMPAD_8,4.5:Spicetify.Keyboard.KEYS.NUMPAD_9},o=ve(e),l=(t=e,()=>{for(const e of Object.values(t))Spicetify.Keyboard._deregisterShortcut({key:e,ctrl:!0,alt:!0})});var t;const s=()=>{S&&S[0].remove(),w=null,xe(e)};new Spicetify.Menu.Item("Star Ratings",!0,()=>{var e,t,a,i,r,n;Spicetify.PopupModal.display({title:"Star Ratings",content:({settings:e,registerKeyboardShortcuts:t,deregisterKeyboardShortcuts:a,updateTracklist:i,restoreTracklist:r,redrawNowPlayingStars:n}=[{settings:f,registerKeyboardShortcuts:o,deregisterKeyboardShortcuts:l,updateTracklist:ke,restoreTracklist:Se,redrawNowPlayingStars:s}][0],d.createElement("div",null,d.createElement(te,{value:"Settings"}),d.createElement(I,{settings:e,name:"Half star ratings",field:"halfStarRatings"}),d.createElement(I,{settings:e,name:"Enable keyboard shortcuts",field:"enableKeyboardShortcuts",onclick:function(){(e.enableKeyboardShortcuts?t:a)()}}),d.createElement(I,{settings:e,name:"Show playlist stars",field:"showPlaylistStars",onclick:function(){(e.showPlaylistStars?i:r)()}}),d.createElement(_,{settings:e,name:"Auto-like/dislike threshold",field:"likeThreshold",options:{Disabled:"disabled","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"}}),d.createElement(_,{settings:e,name:"Now playing stars position",field:"nowPlayingStarsPosition",options:{Left:"left",Right:"right"},onclick:function(){n()}}),d.createElement(_,{settings:e,name:"Skip threshold",field:"skipThreshold",options:{Disabled:"disabled","0.0":"0.0",.5:"0.5","1.0":"1.0",1.5:"1.5","2.0":"2.0",2.5:"2.5","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5"}}),d.createElement(I,{settings:e,name:d.createElement(d.Fragment,null,"Sync duplicate songs with same rating",d.createElement("br",null),"(Does not apply to songs that have already been rated)"),field:"syncDuplicateSongs"}),d.createElement(_,{settings:e,name:"Default rating for unrated songs",field:"defaultRating",options:{"0.0":"0.0",.5:"0.5","1.0":"1.0",1.5:"1.5","2.0":"2.0",2.5:"2.5","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"}}),d.createElement(I,{settings:e,name:d.createElement(d.Fragment,null,"Re-enqueue workaround",d.createElement("br",null),"Workaround for a remote-play issue. Re-enqueues song after 1s, if necessary."),field:"reEnqueueWorkaround"}),d.createElement(te,{value:"Keyboard Shortcuts"}),d.createElement("ul",null,d.createElement(q,{label:"Rate current track 0.5 stars",numberKey:"1"}),d.createElement(q,{label:"Rate current track 1 star",numberKey:"2"}),d.createElement(q,{label:"Rate current track 1.5 stars",numberKey:"3"}),d.createElement(q,{label:"Rate current track 2 stars",numberKey:"4"}),d.createElement(q,{label:"Rate current track 2.5 stars",numberKey:"5"}),d.createElement(q,{label:"Rate current track 3 stars",numberKey:"6"}),d.createElement(q,{label:"Rate current track 3.5 stars",numberKey:"7"}),d.createElement(q,{label:"Rate current track 4 stars",numberKey:"8"}),d.createElement(q,{label:"Rate current track 4.5 stars",numberKey:"9"}),d.createElement(q,{label:"Rate current track 5 stars",numberKey:"0"})))),isLarge:!0})}).register(),c=new MutationObserver(()=>{ke()}),Spicetify.Player.addEventListener("songchange",()=>{var e=Spicetify.Player.data.item.uri;e in m&&"disabled"!==f.skipThreshold&&m[e]<=parseFloat(f.skipThreshold)?Spicetify.Player.next():Ne()}),Spicetify.Platform.History.listen(async()=>{await Ee()}),new Spicetify.ContextMenu.Item("Use as Rated folder",e=>{M(u=e[0]),x=!0,Re().finally(()=>{x=!1})},Pe).register(),new Spicetify.ContextMenu.Item("Sort by rating",e=>{var t,a;Spicetify.PopupModal.display({title:"Modify Custom order?",content:({onClickCancel:t,onClickOK:a}=[{onClickCancel:()=>{Spicetify.PopupModal.hide()},onClickOK:()=>{Spicetify.PopupModal.hide(),E=!0,P("Sorting..."),le(e[0],m).finally(()=>{E=!1})}}][0],i.createElement("div",{className:"parent-div"},i.createElement("p",null,"This will modify the ",i.createElement("b",null,"Custom order")," of the playlist."),i.createElement("div",{className:"button-div"},i.createElement(ae,{name:"Cancel",className:"cancel-button",onButtonClick:t}),i.createElement(ae,{name:"Sort",className:"ok-button",onButtonClick:a}))))})},Ce).register(),new Spicetify.ContextMenu.Item("Create weighted Playlist",e=>{const t=e[0];Spicetify.PopupModal.display({title:"Create Weighted Playlist",content:Spicetify.React.createElement(ne,{onClickCancel:()=>{Spicetify.PopupModal.hide()},onClickCreate:async e=>{Spicetify.PopupModal.hide(),P("Creating weighted playlist...");try{P(await me(t,e)?`Weighted Playlist created with ${e} tracks!`:"Failed to create weighted Playlist")}catch(e){console.error("Error creating weighted Playlist:",e),P("Error creating weighted Playlist")}}})})},Ce).register();var a=new MutationObserver(async()=>{await xe(e)});await xe(e),a.observe(document.body,{childList:!0,subtree:!0}),fe()},(async()=>{await O()})();function P(e){Spicetify.showNotification(e)}function j(e){return Spicetify.LocalStorage.get(e)}function C(e,t){Spicetify.LocalStorage.set(e,t)}function z(){var e=Array.from(Spicetify.Platform.Registry._map?.values?.())?.[40];return Spicetify.Platform.LibraryAPI??e?.instance}function F(){var e=Array.from(Spicetify.Platform.Registry._map?.values?.())?.[41];return Spicetify.Platform.RootlistAPI??e?.instance}function R(){var e=Array.from(Spicetify.Platform.Registry._map?.values?.())?.[42];return Spicetify.Platform.PlaylistAPI??e?.instance}async function A(e,t){var t=navigator.platform.startsWith("Linux")&&navigator.userAgent.includes("Spotify/1.1.84.716")?{after:t}:{after:{uri:t}},a=Spicetify.User?.getUsername?.()??Spicetify.Platform.username;return Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/users/${a}/playlists`,{name:e,...t})}async function W(e){setTimeout(async()=>{await Spicetify.CosmosAsync.post(`sp://core-playlist/v1/playlist/${e}/set-base-permission`,{permission_level:"BLOCKED"})},1e3)}async function H(e){return Spicetify.CosmosAsync.get("https://api.spotify.com/v1/albums/"+e,{offset:0,limit:450})}async function Y(){return F().getContents()}async function $(e){(await z().contains(e))[0]||await z().add({uris:[e],silent:0})}async function G(e,t){await R().remove(e,[{uri:t,uid:""}])}async function K(e){return(await Spicetify.CosmosAsync.get("sp://core-playlist/v1/playlist/"+e)).items}async function J(e){return 1===(await Spicetify.CosmosAsync.get("sp://desktop/v1/version")).version.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})}async function V(e){e=(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/tracks/"+e)).external_ids.isrc;return(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/search",{q:"isrc:"+e,type:"track",limit:50})).tracks.items}function Q(e,t){var a,i,r,n=document.createElement("span"),o="stars-"+e,l=(n.className="stars",n.id=o,n.style.whiteSpace="nowrap",n.style.alignItems="center",n.style.display="flex",[]);for(let e=0;e<5;e++){d=o,a=e+1,c=t,r=i=s=void 0,s="http://www.w3.org/2000/svg",i=document.createElementNS(s,"svg"),d=d+"-"+a,i.id=d,i.style.minHeight=c+"px",i.style.minWidth=c+"px",i.setAttributeNS(null,"width",c+"px"),i.setAttributeNS(null,"height",c+"px"),i.setAttributeNS(null,"viewBox","0 0 32 32"),a=document.createElementNS(s,"defs"),i.append(a),c=document.createElementNS(s,"linearGradient"),a.append(c),c.id=d+"-gradient",a=document.createElementNS(s,"stop"),c.append(a),a.id=d+"-gradient-first",a.setAttributeNS(null,"offset","50%"),a.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r=document.createElementNS(s,"stop"),c.append(r),r.id=d+"-gradient-second",r.setAttributeNS(null,"offset","50%"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),d=document.createElementNS(s,"path"),i.append(d),d.setAttributeNS(null,"fill",`url(#${c.id})`),d.setAttributeNS(null,"d","M20.388,10.918L32,12.118l-8.735,7.749L25.914,31.4l-9.893-6.088L6.127,31.4l2.695-11.533L0,12.118l11.547-1.2L16.026,0.6L20.388,10.918z");var[s,c,d]=[i,a,r];n.append(s),l.push([s,c,d])}return[n,l]}function T(t,e){var a=e/=.5;for(let e=0;e<5;e++){var i=t[e][1],r=t[e][2];i.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)")}for(let e=0;e<a;e++){var n=Math.floor(e/2),o=t[n][1],n=t[n][2];(e%2==0?o:n).setAttributeNS(null,"stop-color","var(--spice-button)")}}function X(e,t,a){t=t.getBoundingClientRect(),t=event.clientX-t.left;let i=a+1;return 8<t||!e.halfStarRatings||(i-=.5),0===a&&t<3&&(i-=e.halfStarRatings?.5:1),i}function Z(e){C("starRatings:settings",JSON.stringify(e))}function L(e){C("starRatings:playlistUris",JSON.stringify(e))}function M(e){C("starRatings:ratedFolderUri",e)}function ee(){return d.createElement("svg",{width:16,height:16,viewbox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:Spicetify.SVGIcons.check}})}function I({settings:t,name:e,field:a,onclick:i}){let[r,n]=Spicetify.React.useState(t[a]);var o=r?"checkbox":"checkbox disabled";return d.createElement("div",{className:"popup-row"},d.createElement("label",{className:"col description"},e),d.createElement("div",{className:"col action"},d.createElement("button",{className:o,onClick:function(){var e=!r;t[a]=e,n(e),Z(t),i&&i()}},d.createElement(ee,null))))}function _({settings:t,name:e,field:a,options:i,onclick:r}){const[n,o]=Spicetify.React.useState(t[a]);var l,s,c=[];for([l,s]of Object.entries(i))c.push(d.createElement("option",{value:s},l));return d.createElement("div",{className:"popup-row"},d.createElement("label",{className:"col description"},e),d.createElement("div",{className:"col action"},d.createElement("select",{value:n,onChange:function(e){o(e.target.value),t[a]=e.target.value,Z(t),r&&r()}},c)))}function q({label:e,numberKey:t}){return d.createElement("li",{className:"main-keyboardShortcutsHelpModal-sectionItem"},d.createElement("span",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-sectionItemName"},e),d.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Ctrl"),d.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Alt"),d.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},t))}function te({value:e}){return d.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},e)}function ae({name:e,className:t,onButtonClick:a}){return i.createElement("button",{className:t,onClick:a},e)}function ie({name:e,className:t,onButtonClick:a}){return r.createElement("button",{className:t,onClick:a},e)}function re({value:e,onChange:t}){return r.createElement("div",{className:"weighted-playlist-input-container"},r.createElement("input",{type:"text",value:e,onChange:t,className:"weighted-playlist-input",placeholder:"Enter number of tracks (e.g., 100, 500, 1000)"}))}function ne({onClickCancel:e,onClickCreate:t}){const[a,i]=r.useState("10");return r.createElement("div",{className:"weighted-playlist-modal"},r.createElement("div",{className:"weighted-playlist-modal-content"},r.createElement("h3",{className:"weighted-playlist-modal-title"},"Create Weighted Playlist"),r.createElement("p",{className:"weighted-playlist-modal-description"},"Select how many tracks you want in your weighted playlist. Tracks will be chosen randomly, weighted by their rating."),r.createElement("div",{className:"weighted-playlist-input-section"},r.createElement("label",{className:"weighted-playlist-label"},"Number of tracks:"),r.createElement(re,{value:a,onChange:function(e){i(e)}})),r.createElement("div",{className:"weighted-playlist-suggested"},r.createElement("span",{className:"weighted-playlist-suggested-label"},"Suggested:"),r.createElement("div",{className:"weighted-playlist-suggested-buttons"},[10,25,50,100,250,500,1e3,2e3,5e3].map(e=>r.createElement("button",{key:e,className:"weighted-playlist-suggested-btn "+(a===e.toString()?"active":""),onClick:()=>i(e.toString())},e)))),r.createElement("div",{className:"weighted-playlist-preview"},r.createElement("span",{className:"weighted-playlist-preview-text"},"Preview: Your playlist will contain ",a," tracks, selected randomly, weighted by their rating.")),r.createElement("div",{className:"weighted-playlist-button-div"},r.createElement(ie,{name:"Cancel",className:"weighted-playlist-cancel-button",onButtonClick:e}),r.createElement(ie,{name:"Create Playlist",className:"weighted-playlist-create-button",onButtonClick:function(){var e=parseInt(a);isNaN(e)||e<=0?alert("Please enter a valid positive number"):t(e)}}))))}function oe(e,t){return e.items.find(e=>"folder"===e.type&&e.name===t)}async function le(a,i){const r=["5.0","4.5","4.0","3.5","3.0","2.5","2.0","1.5","1.0","0.5","0.0"];var n=await K(a);if(0!==n.length){var o={};for(const p of r)o[p]=[];for(const f of n){let e=i[f.link]??0;o[e="number"==typeof e?e.toFixed(1):e].push(f.rowId)}let e=function(e){for(const t of r)if(0<e[t].length)return e[t][0];return null}(o);var l,s,c,d,n=n[0].rowId,u=e===n;let t=!0;for(const m of r)0!==o[m].length&&(!u&&t?(l=a,s=o[m],c=e,d=void 0,d=await J("1.2.5.1006.g22820f93"),await R().move(l,s.map(e=>({uid:e})),{before:d?{uid:c}:c})):(l=a,s=o[m],d=e,c=void 0,c=await J("1.2.5.1006.g22820f93"),await R().move(l,s.map(e=>({uid:e})),{after:c?{uid:d}:d})),t=!1,e=o[m].slice(-1)[0])}}function se(){var e=Spicetify.Platform.History.location.pathname.match(/album\/(.*)/);return e?e[1]:null}function ce(e){return e.replace("spotify:track:","")}function de(e){e=m[e];return e?parseFloat(e):parseFloat(f.defaultRating)}function ue(){return new Promise(async a=>{try{var t=Spicetify.Player?.data?.context||Spicetify.Player?.data?.item?.context||null;if(t&&t.uri){let e=[];if(t.uri.includes("playlist")){var i=t.uri;e=(s=(s=i).split(":").pop(),await(await Spicetify.CosmosAsync.get(`https://api.spotify.com/v1/playlists/${s}/tracks`)).items.map(e=>({uri:e.track.uri,link:e.track.uri,name:e.track.name,artists:e.track.artists.map(e=>e.name).join(", ")})))}else if(t.uri.includes("album")){var r=await H(t.uri.split(":").pop());e=r.tracks.items.map(e=>({uri:e.uri,link:e.uri}))}else{if(!t.uri.includes("collection"))return void a(null);e=await async function(){let e=0;for(var t=[];;){var a=(await Spicetify.CosmosAsync.get(`https://api.spotify.com/v1/me/tracks?limit=50&offset=${e}&market=from_token`))?.items||[];if(!a.length)break;for(const r of a){var i=r?.track?.uri;i&&t.push({uri:i,link:i})}e+=a.length}return t}()}if(0===e.length)a(null);else{const c=Spicetify.Player.data.item?.uri,d=pe();var n=e.filter(t=>t.link!==c&&!d.some(e=>e.uri===t.link));if(0===n.length)a(null);else{var o=n.map(e=>de(e.link)),l=o.reduce((e,t)=>e+t,0);if(l<=0)a(null);else{let t=Math.random()*l;for(let e=0;e<n.length;e++)if((t-=o[e])<=0)return void a(n[e].link);a(n[n.length-1].link)}}}}else a(null)}catch(e){console.error("Error in weighted track selection:",e),a(null)}var s})}function pe(){try{return Spicetify.Queue.nextTracks.filter(e=>"queue"===e.provider).map(e=>({uri:e.contextTrack.uri}))}catch(e){return console.log("Failed to get queued tracks:",e),[]}}async function fe(){for(;;){try{N&&0==pe().length&&await async function(){if(!N)return;try{var e=await ue();e&&(await Spicetify.addToQueue([{uri:e}]),f.reEnqueueWorkaround&&(await new Promise(e=>setTimeout(e,1e3)),pe().map(e=>e.uri).includes(e)||(console.log("Re-enqueueing after 1s:",e),await Spicetify.addToQueue([{uri:e}]))))}catch(e){return!console.error("Error adding weighted track to queue:",e)}}()}catch(e){console.error("Weighted loop error:",e)}let t;t=f.reEnqueueWorkaround?1500:500,await new Promise(e=>setTimeout(e,t))}}async function me(e,t){try{d=(d=e).split(":").pop();var i=(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/playlists/"+d)).name+` (Weighted ${t})`;let a;try{a=await A(i,u)}catch(e){let t=1;for(;t<=100;)try{a=await A(i+` (${t})`,u);break}catch(e){t++}if(!a)throw new Error("Unable to create weighted playlist")}var r=await K(e);if(0!==r.length){var n=r.map(e=>({uri:e.link,weight:de(e.link)})).filter(e=>0<e.weight);if(0===n.length)throw new Error("No tracks with valid weights found");var o=function(t,a){var i=[];for(let e=0;e<a;e++){var r=t.reduce((e,t)=>e+t.weight,0);if(r<=0)break;let e=Math.random()*r;for(const n of t)if((e-=n.weight)<=0){i.push(n);break}}return i}(n,t);if(0===o.length)throw new Error("No tracks could be selected");for(let e=0;e<o.length;e+=50){var l=o.slice(e,e+50).map(e=>e.uri);s=a.uri,c=l,s=s.split(":").pop(),await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${s}/tracks`,{uris:c})}}return a}catch(e){return console.error("Error creating weighted playlist:",e),null}var s,c,d}function ye(){var e=function(e,t){if(console.log("album is:",t),!t)return"0.0";let a=0,i=0;for(const o of t.tracks.items){var r=o.uri,r=parseFloat(e[r]);r&&(a+=r,i+=1)}let n=0;return 0<i&&(n=a/i),(n=Math.round(2*n)/2).toFixed(1)}(m,t);T(s[1],e)}async function ge(e,t){delete m[e];var t=g[t],a=y[t];await G(t,e),P("Removed from "+a)}async function be(e,t,i,r=!0){try{var n;m[e]=i,t&&await G(g[t],e),u||(await F().createFolder("Rated",{before:""}),n=oe(await Y(),"Rated"),M(u=n.uri));let a=g[i];var o=i;if(a){if(8e3<=(await K(a)).length){let t=1,e;for(;;)try{var l=`${i}(${t})`;await W(e=await A(l,u));break}catch(e){if(100<++t)throw new Error("Unable to create overflow playlist")}a=e,g[i]=e,L(g),y[e]=`${i}(${t})`}}else await W(a=await A(o,u)),g[i]=a,L(g),y[a]=o;s=a,c=e,await R().add(s,[c],{after:1,before:0}),P((t?"Moved":"Added")+" to "+y[a]),"disabled"!==f.likeThreshold&&r&&parseFloat(f.likeThreshold)<=parseFloat(i)&&await $(e)}catch(e){console.error("Error in handleSetRating:",e),P("Error updating rating: "+(e.message||"Unknown error"))}var s,c}function he(o,l,s,c){return()=>{if(!(k||x||E)){k=!0;var[,i]=s,i=i[o][0];const r=c(),n=m[r];let a=null!==l?l:X(f,i,o).toFixed(1),e=null,t=null;n===a?(t=0,e=ge(r,a),f.syncDuplicateSongs&&(async()=>{try{for(const t of await V(r.substring(14))){var e=t.uri;e in m&&await ge(e,m[e])}}catch(e){console.error(e)}})()):(t=a,e=be(r,n,a),"disabled"!==f.likeThreshold&&a>=parseFloat(f.likeThreshold)&&$(r),f.syncDuplicateSongs&&(async()=>{try{for(const t of await V(r.substring(14))){var e=t.uri;await be(e,m[e],a,!1)}}catch(e){console.error(e)}})()),e.finally(()=>{var e=function(e){var t="stars-"+e;if(!(e=document.getElementById(t)))return null;var a=[];for(let e=1;e<=5;e++){var i=t+"-"+e,r=document.getElementById(i),n=document.getElementById(i+"-gradient-first"),i=document.getElementById(i+"-gradient-second");a.push([r,n,i])}return[e,a]}(ce(r));e&&(T(e[1],t),e[0].style.visibility=n===a?"hidden":"visible"),Ne(),k=!1})}}}function ve(a){return()=>{for(var[e,t]of Object.entries(a))Spicetify.Keyboard.registerShortcut({key:t,ctrl:!0,alt:!0},he(0,parseFloat(e),S,U))}}function we(e,a){const[t,i]=e;t.addEventListener("mouseout",function(){var e;T(i,(e=a(),m[e]??0))});for(let t=0;t<5;t++){const r=i[t][0];r.addEventListener("mousemove",function(){var e=X(f,r,t);T(i,e)}),r.addEventListener("click",he(t,null,e,a))}}function Se(){document.querySelectorAll(".main-trackList-trackListHeaderRow").forEach(e=>{e.style["grid-template-columns"]=b});for(const i of Array.from(v)){var e=i.getElementsByClassName("main-trackList-trackListRow");for(const r of Array.from(e)){var t,a=r.querySelector(".starRatings");a&&(r.style["grid-template-columns"]=h,a.remove(),a=r.querySelector(".main-trackList-rowSectionEnd"),t=parseInt(a.getAttribute("aria-colindex")),a.setAttribute("aria-colindex",(t-1).toString()))}}}function ke(){if(f.showPlaylistStars){a=v;let t=(v=Array.from(document.querySelectorAll(".main-trackList-indexable"))).length!==a.length;for(let e=0;e<v.length;e++)v[e].isEqualNode(a[e])||(t=!0);t&&(h=b=null);{var e=v;let a=null;var i=document.querySelectorAll(".main-trackList-trackListHeaderRow");i.forEach(e=>{var t=e.querySelector(".main-trackList-rowSectionEnd"),t=parseInt(t.getAttribute("aria-colindex"));(b=b||getComputedStyle(e).gridTemplateColumns)&&p[t]&&(e.style["grid-template-columns"]=p[t],a=p[t])});for(const s of e)for(const c of s.getElementsByClassName("main-trackList-trackListRow")){var r=0<c.getElementsByClassName("stars").length;const d=function(e){return(e=Object.values(e))?(e=e[0]?.pendingProps?.children?.[0]?.props?.children??e[0]?.pendingProps?.children?.props?.value?.item)?.uri||e?.props?.uri||e?.props?.children?.props?.uri||e?.props?.children?.props?.children?.props?.uri||e?.[0]?.props?.uri:null}(c);var n=d.includes("track");let e=c.querySelector(".starRatings");if(e||(o=c.querySelector(".main-trackList-rowSectionEnd"),l=parseInt(o.getAttribute("aria-colindex")),o.setAttribute("aria-colindex",(l+1).toString()),(e=document.createElement("div")).setAttribute("aria-colindex",l.toString()),e.role="gridcell",e.style.display="flex",e.classList.add("main-trackList-rowSectionVariable"),e.classList.add("starRatings"),c.insertBefore(e,o),h=h||getComputedStyle(c).gridTemplateColumns,p[l]&&(c.style["grid-template-columns"]=a||p[l])),d&&!r&&n){var o=Q(ce(d),16);const u=o[0];var l=o[1],r=m[d]??0;e.appendChild(u),T(l,r),we(o,()=>d),u.style.visibility=void 0!==m[d]?"visible":"hidden",c.addEventListener("mouseover",()=>{u.style.visibility="visible"}),c.addEventListener("mouseout",()=>{u.style.visibility=void 0!==m[d]?"visible":"hidden"})}}}}}async function xe(e){n=o,(o=document.querySelector("main"))&&!o.isEqualNode(n)&&(n&&c.disconnect(),ke(),c.observe(o,{childList:!0,subtree:!0})),D=w;var t="left"===f.nowPlayingStarsPosition?".main-nowPlayingWidget-nowPlaying .main-trackInfo-container":".main-nowPlayingBar-right div",t=((w=document.querySelector(t))&&!w.isEqualNode(D)&&((S=Q("now-playing",16))[0].style.marginLeft="8px",S[0].style.marginRight="8px","left"===f.nowPlayingStarsPosition?w.after(S[0]):w.prepend(S[0]),we(S,U),Ne(),f.enableKeyboardShortcuts)&&ve(e)(),B=l,(l=document.querySelector(".main-actionBar-ActionBar .ix_8kg3iUb9VS5SmTnBY"))&&!l.isEqualNode(B)&&null!==se()&&(s=Q("album",32),l.after(s[0]),await Ee()),document.querySelector('[data-testid="control-button-shuffle"]')||document.querySelector('button[aria-label*="Shuffle" i]'));if(t&&!t.nextElementSibling?.classList.contains("weighted-shuffle-button")){const a=document.createElement("button");a.className="weighted-shuffle-button",a.style.cssText=`
            margin-left: 8px;
            background: transparent;
            border: 0px solid white;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-subdued, #6a6a6a);
            font-size: 16px;
            font-weight: bold;
        `,a.textContent="W",a.title="Weighted Shuffle",a.addEventListener("click",()=>{N=!N,a.style.backgroundColor=N?"var(--background-press, #1db954)":"transparent",a.style.borderColor=N?"var(--background-press, #1db954)":"var(--essential-subdued, #878787)",a.style.color=N?"#1DB954":"var(--text-subdued, #6a6a6a)",a.title=N?"Disable Weighted Shuffle":"Enable Weighted Shuffle",P(N?"Weighted shuffle enabled":"Weighted shuffle disabled")}),t.parentNode.insertBefore(a,t.nextSibling)}}async function Ee(){s&&(e=se(),s[0].style.display=e?"flex":"none",console.log("albumId is:",e),e)&&(t=await H(e),ye())}function Ne(){var e,t;S&&(t=(e=Spicetify.Player.data.item.uri).includes("track"),S[0].style.display=t?"flex":"none",t=m[e]??0,T(S[1],t))}function Pe(e){return Spicetify.URI.fromString(e[0]).type===Spicetify.URI.Type.FOLDER}function Ce(e){switch(Spicetify.URI.fromString(e[0]).type){case Spicetify.URI.Type.PLAYLIST:case Spicetify.URI.Type.PLAYLIST_V2:return!0}return!1}async function Re(){u=j("starRatings:ratedFolderUri"),m={},y={},g=function(){try{var e=JSON.parse(j("starRatings:playlistUris"));if(e&&"object"==typeof e)return e;throw""}catch{return C("starRatings:playlistUris","{}"),{}}}();let e=null;var t,a,i,r;u?(t=await Y(),e=(a=u,t.items.find(e=>"folder"===e.type&&e.uri===a))):(t=await Y(),(e=oe(t,"Rated"))&&M(u=e.uri)),e?(i=!1,[i,g]=function(e,t){var a={};let i=!1;for(const[r,n]of Object.entries(e))t.items.find(e=>e.uri===n)?a[r]=n:i=!0;return[i,a]}(g,e),r=!1,[r,g]=function(t,e){const a={...t};let i=!1;const r=["0.0","0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"].filter(e=>!t.hasOwnProperty(e));return e.items.filter(e=>r.includes(e.name)).forEach(e=>{a[e.name]=e.uri,i=!0}),[i,a]}(g,e),(r||i)&&L(g),r=await async function(t){var a=Object.keys(t),i=await Promise.all(a.map(e=>K(t[e]))),r={};for(let e=0;e<a.length;e++)r[a[e]]=i[e];return r}(g),m=function(e){var t,a,i={};for([t,a]of Object.entries(e))for(const r of a)i[r.link]=t;return i}(r),y=function(t,e){const a={};return e.items.filter(e=>Object.values(t).includes(e.uri)).forEach(e=>{a[e.uri]=e.name}),a}(g,e)):0<Object.keys(g).length&&(L(g={}),M(u=""))}(async()=>{var e;document.getElementById("starDratings")||((e=document.createElement("style")).id="starDratings",e.textContent=String.raw`
  .popup-row::after{content:"";display:table;clear:both}.popup-row .col{display:flex;padding:10px 0;align-items:center}.popup-row .col.description{float:left;padding-right:15px}.popup-row .col.action{float:right;text-align:right}.popup-row .div-title{color:var(--spice-text)}.popup-row .divider{height:2px;border-width:0;background-color:var(--spice-button-disabled)}.popup-row .space{margin-bottom:20px;visibility:hidden}button.checkbox{align-items:center;border:0;border-radius:50%;background-color:rgba(var(--spice-rgb-shadow),.7);color:var(--spice-text);cursor:pointer;display:flex;margin-inline-start:12px;padding:8px}button.checkbox.disabled{color:rgba(var(--spice-rgb-text),.3)}select{color:var(--spice-text);background:rgba(var(--spice-rgb-shadow),.7);border:0;height:32px}::-webkit-scrollbar{width:8px}.login-button{background-color:var(--spice-button);border-radius:8px;border-style:none;box-sizing:border-box;color:var(--spice-text);cursor:pointer;display:inline-block;font-size:14px;font-weight:500;height:40px;line-height:20px;list-style:none;margin:10px;outline:0;padding:5px 10px;position:relative;text-align:center;text-decoration:none;vertical-align:baseline;touch-action:manipulation}.parent-div{display:flex;flex-direction:column;gap:8px}.button-div{margin-top:24px;display:flex;gap:16px;justify-content:flex-end}.cancel-button{background-color:transparent;font-weight:700;border:0;color:var(--spice-text);display:inline-flex;border-radius:500px;font-size:inherit;min-block-size:48px;align-items:center;padding-inline:32px}.cancel-button:hover{transform:scale(1.04)}.ok-button{background-color:var(--spice-button-active);font-weight:700;border:0;color:var(--spice-main);display:inline-flex;border-radius:500px;font-size:inherit;min-block-size:48px;align-items:center;padding-inline:32px}.ok-button:hover{transform:scale(1.04)}.weighted-playlist-modal{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000}.weighted-playlist-modal-content{background-color:var(--background-base,#121212);border-radius:8px;padding:24px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}.weighted-playlist-modal-title{margin:0 0 16px 0;color:var(--text-base,#fff);font-size:20px;font-weight:600;font-family:Inter,sans-serif}.weighted-playlist-modal-description{margin:0 0 24px 0;color:var(--text-subdued,#b3b3b3);font-size:14px;line-height:1.5}.weighted-playlist-input-section{margin-bottom:20px}.weighted-playlist-label{display:block;margin-bottom:8px;color:var(--text-base,#fff);font-size:14px;font-weight:500}.weighted-playlist-input-container{display:flex;align-items:center}.weighted-playlist-input{background-color:var(--background-elevated-base,#181818);border:1px solid var(--essential-subdued,#727272);border-radius:4px;padding:8px 12px;color:var(--text-base,#fff);font-size:14px;width:200px;text-align:left;font-family:Inter,sans-serif}.weighted-playlist-input:focus{outline:0;border-color:var(--background-tinted-accent,#1db954);box-shadow:0 0 0 1px var(--background-tinted-accent,#1db954)}.weighted-playlist-input::-moz-placeholder{color:var(--text-subdued,#b3b3b3)}.weighted-playlist-input::placeholder{color:var(--text-subdued,#b3b3b3)}.weighted-playlist-suggested{margin-bottom:20px}.weighted-playlist-suggested-label{display:block;margin-bottom:8px;color:var(--text-subdued,#b3b3b3);font-size:12px;text-transform:uppercase;letter-spacing:.5px;font-weight:600}.weighted-playlist-suggested-buttons{display:flex;gap:8px;flex-wrap:wrap}.weighted-playlist-suggested-btn{background-color:var(--background-tinted-base,#535353);border:none;border-radius:16px;color:var(--text-base,#fff);padding:6px 12px;font-size:12px;cursor:pointer;transition:background-color .2s ease;font-family:Inter,sans-serif;font-weight:500}.weighted-playlist-suggested-btn:hover{background-color:var(--background-tinted-hover,#6a6a6a)}.weighted-playlist-suggested-btn.active{background-color:var(--background-tinted-accent,#1db954)}.weighted-playlist-preview{background-color:var(--background-tinted-base,#181818);border-radius:4px;padding:12px;margin-bottom:24px}.weighted-playlist-preview-text{color:var(--text-subdued,#b3b3b3);font-size:13px;line-height:1.4}.weighted-playlist-button-div{display:flex;justify-content:flex-end;gap:12px}.weighted-playlist-cancel-button,.weighted-playlist-create-button{background-color:transparent;border:1px solid var(--essential-subdued,#878787);border-radius:20px;padding:8px 16px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;cursor:pointer;transition:all .2s ease;font-family:Inter,sans-serif}.weighted-playlist-cancel-button{color:var(--text-subdued,#b3b3b3)}.weighted-playlist-cancel-button:hover{border-color:var(--text-base,#fff);color:var(--text-base,#fff)}.weighted-playlist-create-button{background-color:var(--background-tinted-accent,#1db954);border-color:var(--background-tinted-accent,#1db954);color:var(--text-base,#fff)}.weighted-playlist-create-button:hover{background-color:var(--background-tinted-accent-hover,#1ed760);border-color:var(--background-tinted-accent-hover,#1ed760)}@media (max-width:600px){.weighted-playlist-modal-content{width:95%;padding:20px}.weighted-playlist-suggested-buttons{gap:6px}.weighted-playlist-suggested-btn{padding:4px 10px;font-size:11px}}
      `.trim(),document.head.appendChild(e))})()}();